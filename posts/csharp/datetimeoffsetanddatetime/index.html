<p>在網站，時間是一個非常重要的因素，例如在拍賣網站中，我們需要處理標的物的結標時間，以及在訂單管理系統中，我們需要處理訂單的建立時間和出貨時間等等。而時間在不同的時區之間的轉換是一個很複雜的問題，尤其是當我們的網站需要作為跨國平台和部屬地區出現差異時更是如此。</p>
<h2 id=datetime介紹>DateTime介紹</h2>
<p>在 .NET中，最常用的時間類型是 DateTime。DateTime 類型代表一個日期和時間，包含了年、月、日、時、分、秒和毫秒。在處理本地時間時，DateTime 是一個非常有用的類型，因為它能夠輕鬆地取得本地電腦的系統時間，例如：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=n>DateTime</span> <span class=n>now</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>;</span>
</code></pre></div><p>但是，在有跨國服務需求和部屬在雲端Docker或是VM上時，使用本地時間可能會導致問題。因為不同的時區會有不同的時間偏移量，當你使用本地時間時，可能會因為時區的差異而導致計算錯誤或顯示錯誤的問題。所以，在這種情況下，我們需要使用 DateTimeOffset。</p>
<h2 id=datetimeoffset介紹>DateTimeOffset介紹</h2>
<p>DateTimeOffset 類型代表一個日期和時間，同樣包含了年、月、日、時、分、秒和毫秒，但是它還包含了一個時區偏移量，能夠更好地處理跨時區的問題。DateTimeOffset 可以用來代替 DateTime，例如：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=n>DateTimeOffset</span> <span class=n>now</span> <span class=p>=</span> <span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>Now</span><span class=p>;</span>
</code></pre></div><p>使用 DateTimeOffset 可以避免跨時區的問題，另外我們還需要處理時區的問題。在 .NET 中，我們可以使用 TimeZoneInfo 類型來處理時區的問題。</p>
<p>例如，如果我們要取得台北時間，可以使用以下程式碼：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=n>TimeZoneInfo</span> <span class=n>taipeiTimeZone</span> <span class=p>=</span> <span class=n>TimeZoneInfo</span><span class=p>.</span><span class=n>FindSystemTimeZoneById</span><span class=p>(</span><span class=s>&#34;Asia/Taipei&#34;</span><span class=p>);</span>
<span class=n>DateTimeOffset</span> <span class=n>taipeiTime</span> <span class=p>=</span> <span class=n>TimeZoneInfo</span><span class=p>.</span><span class=n>ConvertTime</span><span class=p>(</span><span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>,</span> <span class=n>taipeiTimeZone</span><span class=p>);</span>
</code></pre></div><p>在這個程式碼中，我們使用了 FindSystemTimeZoneById 方法來找到台北標準時間的時區資訊，然後使用 ConvertTime 方法將 UTC 時間轉換成台北時間。</p>
<h2>延伸閱讀</h2>
<ul>
<li><a href=/blog/posts/csharp/accessmodifiers/>[C#] 存取修飾詞筆記</a></li>
<li><a href=/blog/posts/csharp/lazy/>[C#] Lazy&lt;T> 類別：如何實現延遲初始化</a></li>
<li><a href=/blog/posts/csharp/types/>[C#] 基本數據類型：整數、浮點數、字符、布林、字串和物件</a></li>
<li><a href=/blog/posts/csharp/efcore/eager-lazy-explicitloading/>[C#] 掌握 EF Core 的載入策略：Eager Loading、Lazy Loading和 Explicit Loading</a></li>
<li><a href=/blog/posts/csharp/shallowcopy-and-deepcpoy/>[C#]3分鐘帶你了解淺層複製(Shallow Cpoy)與深層複製(Deep Copy)</a></li>
</ul>