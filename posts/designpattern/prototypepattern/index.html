<h2 id=prototype-pattern的四個要素>Prototype Pattern的四個要素：</h2>
<ol>
<li><strong>模式名稱</strong>：</li>
</ol>
<blockquote>
<p>Prototype Pattern（原型模式）</p>
</blockquote>
<ol start=2>
<li><strong>問題</strong>：</li>
</ol>
<blockquote>
<p>當需要建立多個具有相同或類似屬性的物件時，使用傳統的建立方式可能會導致程式碼重複和效率低下。</p>
</blockquote>
<ol start=3>
<li><strong>解決方案</strong>：</li>
</ol>
<blockquote>
<p>Prototype Pattern透過使用已有的物件來複製建立新物件，從而避免了程式碼重複和效率低下的問題。</p>
</blockquote>
<ol start=4>
<li><strong>結果</strong>：</li>
</ol>
<blockquote>
<p>使用Prototype Pattern可以更加靈活地建立和管理物件，並且可以提高程式碼的重用性和可維護性。</p>
</blockquote>
<h2 id=實作>實作</h2>
<p>在C#中實現原型模式，我們可以使用兩種不同的複製方式：淺層複製和深層複製。</p>
<h3 id=淺層複製>淺層複製</h3>
<p>淺層複製（Shallow Cpoy）是指複製物件時，只複製物件本身及其所有值類型的成員變數，而不複製物件的參考類型成員變數。這意味著複製後的物件和原始物件仍然共享參考類型成員變數，因此對複製物件或原始物件的參考類型成員變數進行修改，將會影響到另一個物件，可以透過實現ICloneable介面來實現。</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=k>public</span> <span class=k>class</span> <span class=nc>MyClass</span> <span class=p>:</span> <span class=n>ICloneable</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=kt>int</span> <span class=n>Value</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=n>List</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>object</span> <span class=n>Clone</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>MemberwiseClone</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>public</span> <span class=k>class</span> <span class=nc>Program</span>
<span class=p>{</span>
    <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>MyClass</span> <span class=n>original</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MyClass</span><span class=p>();</span>
        <span class=n>original</span><span class=p>.</span><span class=n>Value</span> <span class=p>=</span> <span class=m>1</span><span class=p>;</span>
        <span class=n>original</span><span class=p>.</span><span class=n>List</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;()</span> <span class=p>{</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span><span class=p>,</span> <span class=m>3</span> <span class=p>};</span>

        <span class=n>MyClass</span> <span class=n>clone</span> <span class=p>=</span> <span class=p>(</span><span class=n>MyClass</span><span class=p>)</span><span class=n>original</span><span class=p>.</span><span class=n>Clone</span><span class=p>();</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>Value</span> <span class=p>=</span> <span class=m>2</span><span class=p>;</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=p>=</span> <span class=m>4</span><span class=p>;</span>

        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>original</span><span class=p>.</span><span class=n>Value</span><span class=p>);</span> <span class=c1>// Output: 1
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>clone</span><span class=p>.</span><span class=n>Value</span><span class=p>);</span> <span class=c1>// Output: 2
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>original</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span> <span class=c1>// Output: 4
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>clone</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span> <span class=c1>// Output: 4
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><blockquote>
<p>在這個範例程式碼中，我們定義了一個MyClass類別，它實現了ICloneable介面並定義了Value和List成員變數。</p>
</blockquote>
<blockquote>
<p>在Main方法中，我們建立了一個original物件並設定其Value和List成員變數。然後我們透過調用Clone方法來複製這個物件並設定複製物件的Value和List成員變數。</p>
</blockquote>
<blockquote>
<p>最後，我們輸出了original和clone物件的Value和List成員變數，結果顯示出對clone物件的List成員變數進行修改同時也修改了original物件的List成員變數，
<strong>這是因為兩個物件仍然共享同一個List物件的參考</strong>。</p>
</blockquote>
<h3 id=深層複製>深層複製</h3>
<p>如果希望深層複製（Deep Copy）物件，從而完全分離原始物件和複製物件。這種方式需要實現自己的Clone方法，而不是使用ICloneable介面(視情況可以使用遞迴的方式複製樹狀結構等情境)。</p>
<p>以下是深複製的範例程式碼：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=k>public</span> <span class=k>class</span> <span class=nc>MyClass</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=kt>int</span> <span class=n>Value</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=n>List</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>MyClass</span> <span class=n>Clone</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>MyClass</span> <span class=n>clone</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MyClass</span><span class=p>();</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>Value</span> <span class=p>=</span> <span class=n>Value</span><span class=p>;</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>List</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;(</span><span class=n>List</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>clone</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>public</span> <span class=k>class</span> <span class=nc>Program</span>
<span class=p>{</span>
    <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>MyClass</span> <span class=n>original</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MyClass</span><span class=p>();</span>
        <span class=n>original</span><span class=p>.</span><span class=n>Value</span> <span class=p>=</span> <span class=m>1</span><span class=p>;</span>
        <span class=n>original</span><span class=p>.</span><span class=n>List</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;()</span> <span class=p>{</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span><span class=p>,</span> <span class=m>3</span> <span class=p>};</span>

        <span class=n>MyClass</span> <span class=n>clone</span> <span class=p>=</span> <span class=n>original</span><span class=p>.</span><span class=n>Clone</span><span class=p>();</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>Value</span> <span class=p>=</span> <span class=m>2</span><span class=p>;</span>
        <span class=n>clone</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=p>=</span> <span class=m>4</span><span class=p>;</span>

        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>original</span><span class=p>.</span><span class=n>Value</span><span class=p>);</span> <span class=c1>// Output: 1
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>clone</span><span class=p>.</span><span class=n>Value</span><span class=p>);</span> <span class=c1>// Output: 2
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>original</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span> <span class=c1>// Output: 1
</span><span class=c1></span>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>clone</span><span class=p>.</span><span class=n>List</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span> <span class=c1>// Output: 4
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><blockquote>
<p>在這個示例程式碼中，我們定義了一個MyClass類別，它定義了Value和List成員變數，並定義了自己的Clone方法。</p>
</blockquote>
<blockquote>
<p>在Main方法中，我們建立了一個original物件並設定其Value和List成員變數。然後我們透過調用Clone方法來複製這個物件並設定複製物件的Value和List成員變數。在複製List成員變數時，我們使用了List的複製建構子（Copy Constructor）來複製List物件本身。</p>
</blockquote>
<blockquote>
<p>最後，我們輸出了original和clone物件的Value和List成員變數，結果顯示出對clone物件的List成員變數進行修改並不會影響original物件的List成員變數，這是因為兩個物件已經完全分離。</p>
</blockquote>
<p>總之，Prototype模式是一種創建型設計模式，它可以通過複製現有物件來創建新物件，從而避免直接創建物件所帶來的開銷和複雜性。要實現Prototype模式，可以使用ICloneable介面或自己的Clone方法，並分別實現Shadow Clone和Deep Clone的方式來複製物件。在C#中，可以使用ICloneable介面或自己的Clone方法來實現Prototype模式，並透過複製建構子來複製成員變數，從而實現Shadow Clone和Deep Clone的方式。</p>
<h2>延伸閱讀</h2>
<ul>
<li><a href=/blog/posts/designpattern/compositepattern/>[Design Pattern] 掌握設計模式：Composite Pattern原理與應用</a></li>
<li><a href=/blog/posts/designpattern/bridgepattern/>[Design Pattern] 掌握設計模式：Bridge Pattern原理與應用</a></li>
<li><a href=/blog/posts/designpattern/adapterpattern/>[Design Pattern] 掌握設計模式：Adapter Pattern原理與應用</a></li>
<li><a href=/blog/posts/designpattern/builderpattern/>[Design Pattern] 掌握設計模式：Builder Pattern原理與應用</a></li>
<li><a href=/blog/posts/designpattern/abstractfactorypattern/>[Design Pattern] 掌握設計模式：Abstract Factory Pattern原理與應用</a></li>
</ul>